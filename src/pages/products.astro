---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import { Image } from 'astro:assets';
import { products } from '../data/products';

// Import all product images
import giftset1 from '/src/assets/products/giftset-1.jpg';
import giftset2 from '/src/assets/products/giftset-2.jpg';
import giftset3 from '/src/assets/products/giftset-3.jpg';
import giftset4 from '/src/assets/products/giftset-4.jpg';
import giftset5 from '/src/assets/products/giftset-5.jpg';
import romper1 from '/src/assets/products/romper-1.jpg';
import romper2 from '/src/assets/products/romper-2.jpg';
import romper3 from '/src/assets/products/romper-3.jpg';
import romper4 from '/src/assets/products/romper-4.jpg';
import romper5 from '/src/assets/products/romper-5.jpg';
import romper6 from '/src/assets/products/romper-6.jpg';
import romper7 from '/src/assets/products/romper-7.jpg';
import pyjama1 from '/src/assets/products/pyjama-1.jpg';
import pyjama2 from '/src/assets/products/pyjama-2.jpg';
import pyjama3 from '/src/assets/products/pyjama-3.jpg';
import dungaree1 from '/src/assets/products/dungaree-1.jpg';
import dungaree2 from '/src/assets/products/dungaree-2.jpg';
import dungaree3 from '/src/assets/products/dungaree-3.jpg';
import dungaree4 from '/src/assets/products/dungaree-4.jpg';
import twopiece1 from '/src/assets/products/ELCS-56857.jpg';
import twopiece2 from '/src/assets/products/ELDK-56859.jpg';
import twopiece3 from '/src/assets/products/ELDR-56858.jpg';
import twopiece4 from '/src/assets/products/ELDR-56860.jpg';
import twopiece5 from '/src/assets/products/ELDR-56861.jpg';
import twopiece6 from '/src/assets/products/ELDR-56862.jpg';
import twopiece7 from '/src/assets/products/ELDR-56863.jpg';
import twopiece8 from '/src/assets/products/ELDR-56864.jpg';
import giftset4 from '/src/assets/products/giftset-4.jpg';
import starter1 from '/src/assets/products/starter1.jpg';
import starter2 from '/src/assets/products/starter2.jpg';
import starter3 from '/src/assets/products/starter3.jpg';


const products = [
  {
  title: "Dungaree Sets",
  description: "Classic dungarees paired with soft inner tees ‚Äî playful style with all-day comfort.",
  badges: ["Stylish", "Layer Friendly"],
  images: [dungaree1, dungaree2, dungaree3, dungaree4],
  slug: "dungaree-sets",
  orientation: "landscape",
  features: [
    "Adjustable straps and snap buttons",
    "Includes matching innerwear",
    "Durable yet soft fabrics",
    "Size: 0-24 months"
  ]
},

{
  title: "Gift Sets",
  description: "Beautifully packaged babywear sets designed for gifting, featuring coordinated outfits and accessories.",
  badges: ["Popular", "GOTS Certified", "Gift Box"],
  images: [giftset1, giftset2, giftset3, giftset4, giftset5],
  slug: "gift-sets",
  orientation: "landscape",
  features: [
    "Organic or GOTS-certified cotton",
    "Ready-to-gift packaging included",
    "Stylish designs for special occasions",
    "Size: 0-24 months"
  ]
},
{
  title: "Rompers & Playsuits",
  description: "Effortless one-piece outfits for everyday play and comfort ‚Äî easy to wear, easy to love.",
  badges: ["Best Seller", "Organic Fabric"],
  images: [romper1, romper2, romper3, romper4, romper4, romper6, romper7],
  slug: "rompers-playsuits",
  orientation: "landscape",
  features: [
    "Snap closures for quick changes",
    "Soft cotton or cotton blends",
    "Fun prints and practical design",
    "Size: 0-36 months"
  ]
},
{
  title: "Starter Sets",
  description: "Complete newborn essentials bundled for convenience ‚Äî perfect for hospital bags, gifting, or first outfits.",
  badges: ["Organic Cotton", "Gift Ready", "0-3 Months"],
  images: [starter1, starter2, starter3], // Replace with actual starter set image vars
  slug: "starter-sets",
  orientation: "portrait",
  features: [
    "Available in 4, 6, and 7-piece sets",
    "Includes sleepsuit, bodysuit, booties, mittens, bib, hat, and blanket (varies by set)",
    "Coordinated color themes and embroidery",
    "Soft and breathable fabric",
    "Packaged for gifting"
  ]
},
{
  title: "Pyjama Sets",
  description: "Soft, breathable nightwear designed to keep babies cozy through the night.",
  badges: ["Nightwear Essential", "Ultra Soft"],
  images: [pyjama1, pyjama2, pyjama3],
  slug: "pyjama-sets",
  orientation: "portrait",
  features: [
    "100% Organic Cotton",
    "Long-sleeve tops with matching bottoms",
    "Designed for restful sleep",
    "Size: 0-24 months"
  ]
},
{
  title: "Two-Piece Sets",
  description: "Flexible outfit sets with matching tops and bottoms ‚Äî perfect for everyday wear or going out.",
  badges: ["New Arrival", "Mix & Match"],
  images: [twopiece1, twopiece2, twopiece3, twopiece4, twopiece5, twopiece6, twopiece7, twopiece8],
  slug: "two-piece-sets",
  orientation: "portrait",
  features: [
    "Wear together or separately",
    "Comfortable elastic waistbands",
    "Easy care cotton or blends",
    "Size: 0-36 months"
  ]
}



];
---

<Layout title="Products - Kids Kreations">
  <Navigation />
  
  <main>
    <section class="hero product-hero">
      <div class="container">
        <div class="section-title">
          <h1>Explore Our Infantwear Collection</h1>
          <p>Flexible MOQs, GOTS-certified materials, custom packaging, and export-ready babywear.</p>
        </div>
      </div>
    </section>

    <section class="products">
      <div class="container">
        <div class="products-grid">
          {products.map(product => (
            <article class="product-card" data-orientation={product.orientation}>
              <div class="product-image-wrapper">
                {product.images ? (
                  <div class="product-gallery">
                    {product.images.map((image, index) => (
                      <Image 
                        src={image} 
                        alt={`${product.title} - View ${index + 1}`}
                        class="product-image"
                        loading={index === 0 ? "eager" : "lazy"}
                        style={`display: ${index === 0 ? 'block' : 'none'}`}
                        width={800}
                        height={600}
                        quality={95}
                        format="webp"
                      />
                    ))}
                    <button class="gallery-nav gallery-prev" aria-label="Previous image">‚Üê</button>
                    <button class="gallery-nav gallery-next" aria-label="Next image">‚Üí</button>
                    <div class="gallery-dots">
                      {product.images.map((_, index) => (
                        <button 
                          class="gallery-dot" 
                          aria-label={`View image ${index + 1}`}
                          data-index={index}
                        ></button>
                      ))}
                    </div>
                    <button class="zoom-button" aria-label="Zoom image">
                      <i class="fas fa-search-plus"></i>
                    </button>
                  </div>
                ) : (
                  <Image 
                    src={product.image} 
                    alt={product.title}
                    class="product-image"
                    loading="lazy"
                    width={800}
                    height={600}
                    quality={95}
                    format="webp"
                  />
                )}
              </div>
              <div class="product-info">
                <h3 class="product-title">{product.title}</h3>
                <p class="product-description">{product.description}</p>
                <ul class="product-features">
                  {product.features.slice(0, 3).map(feature => (
                    <li class="feature-item">
                      <i class="fas fa-check"></i>
                      <span>{feature}</span>
                    </li>
                  ))}
                  {product.features.length > 3 && (
                    <li class="feature-more">
                      <a href={`/products/${product.slug}`}>+{product.features.length - 3} more features</a>
                    </li>
                  )}
                </ul>
                <div class="product-badges">
                  {product.badges.slice(0, 3).map(badge => (
                    <span class={`badge ${
                      badge.includes('GOTS') || badge.includes('Organic') ? 'badge-green' :
                      badge.includes('Best') || badge.includes('Popular') ? 'badge-purple' :
                      'badge-blue'
                    }`}>
                      {badge.includes('Organic') ? 'üåø' : 
                       badge.includes('Gift') ? 'üéÅ' : 
                       badge.includes('Best') ? '‚≠ê' : ''} 
                      {badge}
                    </span>
                  ))}
                </div>
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>

    <section class="cta-section">
      <div class="container">
        <div class="cta-content">
          <h2>Interested in Our Products?</h2>
          <p>Contact us to discuss your specific requirements and get a custom quote</p>
          <a href="/contact" class="button button-primary">Request Quote</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Image Modal -->
  <div id="imageModal" class="image-modal" role="dialog" aria-modal="true" aria-label="Product image viewer">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close modal">√ó</button>
      <button class="modal-nav modal-prev" aria-label="Previous image">‚Üê</button>
      <button class="modal-nav modal-next" aria-label="Next image">‚Üí</button>
      <div class="modal-image-container">
        <img 
          id="modalImage" 
          src="" 
          alt="Product image"
          class="modal-image"
        />
      </div>
    </div>
  </div>

  <Footer />
</Layout>

<style>
  .product-hero {
    background: linear-gradient(to right, var(--primary-light), var(--background));
    padding: var(--spacing-xl) 0;
    text-align: center;
  }

  .section-title {
    max-width: 800px;
    margin: 0 auto;
  }

  .section-title h1 {
    font-size: 2.5rem;
    margin-bottom: var(--spacing-sm);
  }

  .products {
    padding: var(--spacing-xl) 0;
    background: var(--background);
  }

  .products-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-lg);
    max-width: 1400px;
    margin: 0 auto;
  }

  .product-card {
    background: white;
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all 0.3s ease;
    height: 100%;
    box-shadow: var(--shadow-sm);
    display: flex;
    flex-direction: column;
    animation: fadeIn 0.5s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .product-image-wrapper {
    position: relative;
    overflow: hidden;
    background: #f8f8f8;
    aspect-ratio: var(--aspect-ratio);
  }

  .product-card[data-orientation="portrait"] {
    --aspect-ratio: 3/4;
  }

  .product-card[data-orientation="landscape"] {
    --aspect-ratio: 4/3;
  }

  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-image {
    transform: scale(1.05);
  }

  .product-info {
    padding: var(--spacing-md);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    flex: 1;
  }

  .product-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-dark);
    margin: 0;
    line-height: 1.4;
  }

  .product-description {
    color: var(--text-light);
    font-size: 0.95rem;
    line-height: 1.5;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .product-features {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .feature-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-light);
  }

  .feature-item i {
    color: var(--primary);
    font-size: 0.75rem;
  }

  .feature-more {
    font-size: 0.875rem;
    margin-top: 0.25rem;
  }

  .feature-more a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .feature-more a:hover {
    color: var(--primary-dark);
  }

  .product-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: auto;
    padding-top: var(--spacing-sm);
  }

  .badge {
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    white-space: nowrap;
  }

  .badge-blue {
    background: #EEF2FF;
    color: #4F46E5;
  }

  .badge-green {
    background: #ECFDF5;
    color: #059669;
  }

  .badge-purple {
    background: #F5F3FF;
    color: #7C3AED;
  }

  .zoom-button {
    position: absolute;
    top: var(--spacing-sm);
    right: var(--spacing-sm);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 20;
    backdrop-filter: blur(4px);
    opacity: 0;
  }

  .product-card:hover .zoom-button {
    opacity: 1;
  }

  .zoom-button:hover {
    background: var(--primary);
    color: white;
    transform: scale(1.1);
  }

  .gallery-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.8);
    border: none;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    cursor: pointer;
    color: var(--text-dark);
    transition: all 0.3s ease;
    z-index: 20;
    opacity: 0;
    backdrop-filter: blur(4px);
  }

  .gallery-prev {
    left: 8px;
  }

  .gallery-next {
    right: 8px;
  }

  .product-card:hover .gallery-nav {
    opacity: 1;
  }

  .gallery-nav:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-50%) scale(1.1);
  }

  .gallery-dots {
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 4px;
    z-index: 20;
    background: rgba(255, 255, 255, 0.5);
    padding: 4px 8px;
    border-radius: var(--radius-full);
    backdrop-filter: blur(4px);
  }

  .gallery-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .gallery-dot.active {
    background: var(--primary);
    transform: scale(1.2);
  }

  @media (max-width: 1200px) {
    .products-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .products-grid {
      grid-template-columns: 1fr;
    }

    .product-card {
      max-width: 500px;
      margin: 0 auto;
    }
  }

  .image-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .image-modal.active {
    display: flex;
    opacity: 1;
  }

  .modal-content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-xl);
  }

  .modal-image-container {
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-image {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    border-radius: var(--radius-lg);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }

  .modal-close {
    position: absolute;
    top: var(--spacing-lg);
    right: var(--spacing-lg);
    background: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-dark);
    transition: all 0.3s ease;
    z-index: 1001;
  }

  .modal-close:hover {
    background: var(--primary);
    color: white;
    transform: scale(1.1);
  }

  .modal-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-dark);
    transition: all 0.3s ease;
    z-index: 1001;
    backdrop-filter: blur(4px);
  }

  .modal-prev {
    left: var(--spacing-lg);
  }

  .modal-next {
    right: var(--spacing-lg);
  }

  .modal-nav:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-50%) scale(1.1);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize image galleries
    document.querySelectorAll('.product-gallery').forEach(gallery => {
      const images = Array.from(gallery.querySelectorAll('.product-image'));
      const dots = Array.from(gallery.querySelectorAll('.gallery-dot'));
      const prevBtn = gallery.querySelector('.gallery-prev');
      const nextBtn = gallery.querySelector('.gallery-next');
      const zoomBtn = gallery.querySelector('.zoom-button');
      let currentIndex = 0;

      function showImage(index) {
        images.forEach(img => {
          img.style.display = 'none';
        });
        
        dots.forEach(dot => {
          dot.classList.remove('active');
        });
        
        images[index].style.display = 'block';
        dots[index].classList.add('active');
        currentIndex = index;
      }

      if (prevBtn) {
        prevBtn.onclick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          const newIndex = (currentIndex - 1 + images.length) % images.length;
          showImage(newIndex);
        };
      }

      if (nextBtn) {
        nextBtn.onclick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          const newIndex = (currentIndex + 1) % images.length;
          showImage(newIndex);
        };
      }

      dots.forEach((dot, index) => {
        dot.onclick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          showImage(index);
        };
      });

      if (zoomBtn) {
        zoomBtn.onclick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          openModal(images[currentIndex].src, gallery, currentIndex);
        };
      }

      showImage(0);
    });

    // Modal functionality
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const closeBtn = document.querySelector('.modal-close');
    const prevBtn = document.querySelector('.modal-prev');
    const nextBtn = document.querySelector('.modal-next');
    
    let currentGallery = null;
    let currentImageIndex = 0;
    
    function openModal(imageSrc, gallery, index) {
      modalImg.src = imageSrc;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      currentGallery = gallery;
      currentImageIndex = index;
      updateNavigationButtons();
      
      // Trap focus within modal
      modal.focus();
    }
    
    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
      currentGallery = null;
      currentImageIndex = 0;
    }

    function showNextImage() {
      if (!currentGallery) return;
      const images = currentGallery.querySelectorAll('.product-image');
      currentImageIndex = (currentImageIndex + 1) % images.length;
      modalImg.src = images[currentImageIndex].src;
      updateNavigationButtons();
    }

    function showPrevImage() {
      if (!currentGallery) return;
      const images = currentGallery.querySelectorAll('.product-image');
      currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
      modalImg.src = images[currentImageIndex].src;
      updateNavigationButtons();
    }

    function updateNavigationButtons() {
      if (!currentGallery) return;
      const images = currentGallery.querySelectorAll('.product-image');
      prevBtn.style.display = images.length > 1 ? 'flex' : 'none';
      nextBtn.style.display = images.length > 1 ? 'flex' : 'none';
    }
    
    closeBtn.addEventListener('click', closeModal);
    
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
    
    prevBtn.addEventListener('click', showPrevImage);
    nextBtn.addEventListener('click', showNextImage);
    
    document.addEventListener('keydown', (e) => {
      if (!modal.classList.contains('active')) return;
      
      switch(e.key) {
        case 'Escape':
          closeModal();
          break;
        case 'ArrowLeft':
          showPrevImage();
          break;
        case 'ArrowRight':
          showNextImage();
          break;
      }
    });
  });
</script> 